import { db, ChangeSet, MenuItem } from '../db';import { resolveTemplate } from '../templates/resolveTemplate';import { validateRecipeAgainstTemplate } from '../recipes/validateRecipe';/** * applyChangeSet * - ChangeSet içindeki patchleri srayla uygular * - Validation baarszsa ilemi durdurur */export async function applyChangeSet(cs: ChangeSet): Promise<void> {  for (const patch of cs.patches) {    switch (patch.type) {      case 'ADD_MENU_ITEM': {        const item: MenuItem = patch.payload;        // Template resolve (yoksa hata)        const template = resolveTemplate(item.templateId);        // Recipe varsa, templatee göre dorula        if (item.recipeId) {          const recipe = await db.recipes.get(item.recipeId);          if (!recipe) {            throw new Error(`Recipe not found: ${item.recipeId}`);          }          const validation = validateRecipeAgainstTemplate(recipe, template);          if (!validation.valid) {            throw new Error(              `Recipe validation failed. Missing sections: ${validation.missingSections?.join(', ')}`            );          }        }        await db.menuItems.put({          ...item,          createdAt: Date.now(),          updatedAt: Date.now()        });        break;      }      default:        throw new Error(`Unknown patch type: ${patch.type}`);    }  }}
